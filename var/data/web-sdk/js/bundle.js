!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).ASDK=t()}(this,function(){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(o=n.key,"symbol"==typeof(i=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(o,"string"))?i:String(i)),n)}var o,i}function s(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function e(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&c(e,t)}function i(e){return(i=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function u(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function o(e,t,r){return(o=u()?Reflect.construct.bind():function(e,t,r){var n=[null];n.push.apply(n,t);var o=new(Function.bind.apply(e,n));return r&&c(o,r.prototype),o}).apply(null,arguments)}function t(e){var n="function"==typeof Map?new Map:void 0;return(t=function(e){if(null===e||(t=e,-1===Function.toString.call(t).indexOf("[native code]")))return e;var t;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(e))return n.get(e);n.set(e,r)}function r(){return o(e,arguments,i(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),c(r,e)})(e)}function f(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function l(n){var o=u();return function(){var e,t=i(n);if(o){var r=i(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return f(this,e)}}function g(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,i,a,s=[],c=!0,u=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=i.call(r)).done)&&(s.push(n.value),s.length!==t);c=!0);}catch(e){u=!0,o=e}finally{try{if(!c&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(u)throw o}}return s}}(e,t)||_(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _(e,t){if(e){if("string"==typeof e)return h(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?h(e,t):void 0}}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var d="undefined"!=typeof globalThis&&globalThis||"undefined"!=typeof self&&self||void 0!==d&&d,r="URLSearchParams"in d,p="Symbol"in d&&"iterator"in Symbol,y="FileReader"in d&&"Blob"in d&&function(){try{return new Blob,!0}catch(e){return!1}}(),m="FormData"in d,v="ArrayBuffer"in d;if(v)var b=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],w=ArrayBuffer.isView||function(e){return e&&-1<b.indexOf(Object.prototype.toString.call(e))};function S(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(e)||""===e)throw new TypeError('Invalid character in header field name: "'+e+'"');return e.toLowerCase()}function E(e){return"string"!=typeof e&&(e=String(e)),e}function A(t){var e={next:function(){var e=t.shift();return{done:void 0===e,value:e}}};return p&&(e[Symbol.iterator]=function(){return e}),e}function j(t){this.map={},t instanceof j?t.forEach(function(e,t){this.append(t,e)},this):Array.isArray(t)?t.forEach(function(e){this.append(e[0],e[1])},this):t&&Object.getOwnPropertyNames(t).forEach(function(e){this.append(e,t[e])},this)}function P(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function T(r){return new Promise(function(e,t){r.onload=function(){e(r.result)},r.onerror=function(){t(r.error)}})}function k(e){var t=new FileReader,r=T(t);return t.readAsArrayBuffer(e),r}function O(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function R(){return this.bodyUsed=!1,this._initBody=function(e){var t;this.bodyUsed=this.bodyUsed,(this._bodyInit=e)?"string"==typeof e?this._bodyText=e:y&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:m&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:r&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():v&&y&&((t=e)&&DataView.prototype.isPrototypeOf(t))?(this._bodyArrayBuffer=O(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):v&&(ArrayBuffer.prototype.isPrototypeOf(e)||w(e))?this._bodyArrayBuffer=O(e):this._bodyText=e=Object.prototype.toString.call(e):this._bodyText="",this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):r&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},y&&(this.blob=function(){var e=P(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){if(this._bodyArrayBuffer){var e=P(this);return e?e:ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer)}return this.blob().then(k)}),this.text=function(){var e,t,r,n=P(this);if(n)return n;if(this._bodyBlob)return e=this._bodyBlob,t=new FileReader,r=T(t),t.readAsText(e),r;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),r=new Array(t.length),n=0;n<t.length;n++)r[n]=String.fromCharCode(t[n]);return r.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},m&&(this.formData=function(){return this.text().then(U)}),this.json=function(){return this.text().then(JSON.parse)},this}j.prototype.append=function(e,t){e=S(e),t=E(t);var r=this.map[e];this.map[e]=r?r+", "+t:t},j.prototype.delete=function(e){delete this.map[S(e)]},j.prototype.get=function(e){return e=S(e),this.has(e)?this.map[e]:null},j.prototype.has=function(e){return this.map.hasOwnProperty(S(e))},j.prototype.set=function(e,t){this.map[S(e)]=E(t)},j.prototype.forEach=function(e,t){for(var r in this.map)this.map.hasOwnProperty(r)&&e.call(t,this.map[r],r,this)},j.prototype.keys=function(){var r=[];return this.forEach(function(e,t){r.push(t)}),A(r)},j.prototype.values=function(){var t=[];return this.forEach(function(e){t.push(e)}),A(t)},j.prototype.entries=function(){var r=[];return this.forEach(function(e,t){r.push([t,e])}),A(r)},p&&(j.prototype[Symbol.iterator]=j.prototype.entries);var x=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function D(e,t){if(!(this instanceof D))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');var r,n,o=(t=t||{}).body;if(e instanceof D){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new j(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,o||null==e._bodyInit||(o=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"same-origin",!t.headers&&this.headers||(this.headers=new j(t.headers)),this.method=(r=t.method||this.method||"GET",n=r.toUpperCase(),-1<x.indexOf(n)?n:r),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&o)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(o),!("GET"!==this.method&&"HEAD"!==this.method||"no-store"!==t.cache&&"no-cache"!==t.cache)){var i=/([?&])_=[^&]*/;if(i.test(this.url))this.url=this.url.replace(i,"$1_="+(new Date).getTime());else{this.url+=(/\?/.test(this.url)?"&":"?")+"_="+(new Date).getTime()}}}function U(e){var o=new FormData;return e.trim().split("&").forEach(function(e){if(e){var t=e.split("="),r=t.shift().replace(/\+/g," "),n=t.join("=").replace(/\+/g," ");o.append(decodeURIComponent(r),decodeURIComponent(n))}}),o}function I(e,t){if(!(this instanceof I))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');t=t||{},this.type="default",this.status=void 0===t.status?200:t.status,this.ok=200<=this.status&&this.status<300,this.statusText=void 0===t.statusText?"":""+t.statusText,this.headers=new j(t.headers),this.url=t.url||"",this._initBody(e)}D.prototype.clone=function(){return new D(this,{body:this._bodyInit})},R.call(D.prototype),R.call(I.prototype),I.prototype.clone=function(){return new I(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new j(this.headers),url:this.url})},I.error=function(){var e=new I(null,{status:0,statusText:""});return e.type="error",e};var B=[301,302,303,307,308];I.redirect=function(e,t){if(-1===B.indexOf(t))throw new RangeError("Invalid status code");return new I(null,{status:t,headers:{location:e}})};var L=d.DOMException;try{new L}catch(e){(L=function(e,t){this.message=e,this.name=t;var r=Error(e);this.stack=r.stack}).prototype=Object.create(Error.prototype),L.prototype.constructor=L}function F(o,a){return new Promise(function(n,e){var t=new D(o,a);if(t.signal&&t.signal.aborted)return e(new L("Aborted","AbortError"));var i=new XMLHttpRequest;function r(){i.abort()}i.onload=function(){var e,o,t={status:i.status,statusText:i.statusText,headers:(e=i.getAllResponseHeaders()||"",o=new j,e.replace(/\r?\n[\t ]+/g," ").split("\r").map(function(e){return 0===e.indexOf("\n")?e.substr(1,e.length):e}).forEach(function(e){var t=e.split(":"),r=t.shift().trim();if(r){var n=t.join(":").trim();o.append(r,n)}}),o)};t.url="responseURL"in i?i.responseURL:t.headers.get("X-Request-URL");var r="response"in i?i.response:i.responseText;setTimeout(function(){n(new I(r,t))},0)},i.onerror=function(){setTimeout(function(){e(new TypeError("Network request failed"))},0)},i.ontimeout=function(){setTimeout(function(){e(new TypeError("Network request failed"))},0)},i.onabort=function(){setTimeout(function(){e(new L("Aborted","AbortError"))},0)},i.open(t.method,function(t){try{return""===t&&d.location.href?d.location.href:t}catch(e){return t}}(t.url),!0),"include"===t.credentials?i.withCredentials=!0:"omit"===t.credentials&&(i.withCredentials=!1),"responseType"in i&&(y?i.responseType="blob":v&&t.headers.get("Content-Type")&&-1!==t.headers.get("Content-Type").indexOf("application/octet-stream")&&(i.responseType="arraybuffer")),!a||"object"!=typeof a.headers||a.headers instanceof j?t.headers.forEach(function(e,t){i.setRequestHeader(t,e)}):Object.getOwnPropertyNames(a.headers).forEach(function(e){i.setRequestHeader(e,E(a.headers[e]))}),t.signal&&(t.signal.addEventListener("abort",r),i.onreadystatechange=function(){4===i.readyState&&t.signal.removeEventListener("abort",r)}),i.send(void 0===t._bodyInit?null:t._bodyInit)})}F.polyfill=!0,d.fetch||(d.fetch=F,d.Headers=j,d.Request=D,d.Response=I);var C="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function N(t){var r=this.constructor;return this.then(function(e){return r.resolve(t()).then(function(){return e})},function(e){return r.resolve(t()).then(function(){return r.reject(e)})})}function q(r){return new this(function(n,e){if(!r||void 0===r.length)return e(new TypeError(typeof r+" "+r+" is not iterable(cannot read property Symbol(Symbol.iterator))"));var o=Array.prototype.slice.call(r);if(0===o.length)return n([]);var i=o.length;function a(t,e){if(e&&("object"==typeof e||"function"==typeof e)){var r=e.then;if("function"==typeof r)return void r.call(e,function(e){a(t,e)},function(e){o[t]={status:"rejected",reason:e},0==--i&&n(o)})}o[t]={status:"fulfilled",value:e},0==--i&&n(o)}for(var t=0;t<o.length;t++)a(t,o[t])})}!function(t){function e(t){var e={next:function(){var e=t.shift();return{done:void 0===e,value:e}}};return o&&(e[Symbol.iterator]=function(){return e}),e}function n(e){return encodeURIComponent(e).replace(/%20/g,"+")}function i(e){return decodeURIComponent(String(e).replace(/\+/g," "))}var a,r,o=function(){try{return!!Symbol.iterator}catch(e){return!1}}();!function(){try{var e=t.URLSearchParams;return"a=1"===new e("?a=1").toString()&&"function"==typeof e.prototype.set&&"function"==typeof e.prototype.entries}catch(e){return!1}}()&&((r=(a=function(e){Object.defineProperty(this,"_entries",{writable:!0,value:{}});var t=typeof e;if("undefined"!=t)if("string"==t)""!==e&&this._fromString(e);else if(e instanceof a){var r=this;e.forEach(function(e,t){r.append(t,e)})}else{if(null===e||"object"!=t)throw new TypeError("Unsupported input's type for URLSearchParams");if("[object Array]"===Object.prototype.toString.call(e))for(var n=0;n<e.length;n++){var o=e[n];if("[object Array]"!==Object.prototype.toString.call(o)&&2===o.length)throw new TypeError("Expected [string, any] as entry at index "+n+" of URLSearchParams's input");this.append(o[0],o[1])}else for(var i in e)e.hasOwnProperty(i)&&this.append(i,e[i])}}).prototype).append=function(e,t){e in this._entries?this._entries[e].push(String(t)):this._entries[e]=[String(t)]},r.delete=function(e){delete this._entries[e]},r.get=function(e){return e in this._entries?this._entries[e][0]:null},r.getAll=function(e){return e in this._entries?this._entries[e].slice(0):[]},r.has=function(e){return e in this._entries},r.set=function(e,t){this._entries[e]=[String(t)]},r.forEach=function(e,t){var r;for(var n in this._entries)if(this._entries.hasOwnProperty(n)){r=this._entries[n];for(var o=0;o<r.length;o++)e.call(t,r[o],n,this)}},r.keys=function(){var r=[];return this.forEach(function(e,t){r.push(t)}),e(r)},r.values=function(){var t=[];return this.forEach(function(e){t.push(e)}),e(t)},r.entries=function(){var r=[];return this.forEach(function(e,t){r.push([t,e])}),e(r)},o&&(r[Symbol.iterator]=r.entries),r.toString=function(){var r=[];return this.forEach(function(e,t){r.push(n(t)+"="+n(e))}),r.join("&")},t.URLSearchParams=a);var s=t.URLSearchParams.prototype;"function"!=typeof s.sort&&(s.sort=function(){var r=this,n=[];this.forEach(function(e,t){n.push([t,e]),r._entries||r.delete(t)}),n.sort(function(e,t){return e[0]<t[0]?-1:e[0]>t[0]?1:0}),r._entries&&(r._entries={});for(var e=0;e<n.length;e++)this.append(n[e][0],n[e][1])}),"function"!=typeof s._fromString&&Object.defineProperty(s,"_fromString",{enumerable:!1,configurable:!1,writable:!1,value:function(e){if(this._entries)this._entries={};else{var r=[];this.forEach(function(e,t){r.push(t)});for(var t=0;t<r.length;t++)this.delete(r[t])}var n,o=(e=e.replace(/^\?/,"")).split("&");for(t=0;t<o.length;t++)n=o[t].split("="),this.append(i(n[0]),1<n.length?i(n[1]):"")}})}(void 0!==C?C:"undefined"!=typeof window?window:"undefined"!=typeof self?self:C),function(l){var t,r;function e(e,t){"string"!=typeof e&&(e=String(e)),t&&"string"!=typeof t&&(t=String(t));var r,n=document;if(t&&(void 0===l.location||t!==l.location.href)){t=t.toLowerCase(),(r=(n=document.implementation.createHTMLDocument("")).createElement("base")).href=t,n.head.appendChild(r);try{if(0!==r.href.indexOf(t))throw new Error(r.href)}catch(e){throw new Error("URL unable to set base "+t+" due to "+e)}}var o=n.createElement("a");o.href=e,r&&(n.body.appendChild(o),o.href=o.href);var i=n.createElement("input");if(i.type="url",i.value=e,":"===o.protocol||!/:/.test(o.href)||!i.checkValidity()&&!t)throw new TypeError("Invalid URL");Object.defineProperty(this,"_anchorElement",{value:o});var a=new l.URLSearchParams(this.search),s=!0,c=!0,u=this;["append","delete","set"].forEach(function(e){var t=a[e];a[e]=function(){t.apply(a,arguments),s&&(c=!1,u.search=a.toString(),c=!0)}}),Object.defineProperty(this,"searchParams",{value:a,enumerable:!0});var f=void 0;Object.defineProperty(this,"_updateSearchParams",{enumerable:!1,configurable:!1,writable:!1,value:function(){this.search!==f&&(f=this.search,c&&(s=!1,this.searchParams._fromString(this.search),s=!0))}})}if(!function(){try{var e=new l.URL("b","http://a");return e.pathname="c d","http://a/c%20d"===e.href&&e.searchParams}catch(e){return!1}}()&&(t=l.URL,r=e.prototype,["hash","host","hostname","port","protocol"].forEach(function(e){var t;t=e,Object.defineProperty(r,t,{get:function(){return this._anchorElement[t]},set:function(e){this._anchorElement[t]=e},enumerable:!0})}),Object.defineProperty(r,"search",{get:function(){return this._anchorElement.search},set:function(e){this._anchorElement.search=e,this._updateSearchParams()},enumerable:!0}),Object.defineProperties(r,{toString:{get:function(){var e=this;return function(){return e.href}}},href:{get:function(){return this._anchorElement.href.replace(/\?$/,"")},set:function(e){this._anchorElement.href=e,this._updateSearchParams()},enumerable:!0},pathname:{get:function(){return this._anchorElement.pathname.replace(/(^\/?)/,"/")},set:function(e){this._anchorElement.pathname=e},enumerable:!0},origin:{get:function(){var e={"http:":80,"https:":443,"ftp:":21}[this._anchorElement.protocol],t=this._anchorElement.port!=e&&""!==this._anchorElement.port;return this._anchorElement.protocol+"//"+this._anchorElement.hostname+(t?":"+this._anchorElement.port:"")},enumerable:!0},password:{get:function(){return""},set:function(e){},enumerable:!0},username:{get:function(){return""},set:function(e){},enumerable:!0}}),e.createObjectURL=function(e){return t.createObjectURL.apply(t,arguments)},e.revokeObjectURL=function(e){return t.revokeObjectURL.apply(t,arguments)},l.URL=e),void 0!==l.location&&!("origin"in l.location)){var n=function(){return l.location.protocol+"//"+l.location.hostname+(l.location.port?":"+l.location.port:"")};try{Object.defineProperty(l.location,"origin",{get:n,enumerable:!0})}catch(e){setInterval(function(){l.location.origin=n()},100)}}}(void 0!==C?C:"undefined"!=typeof window?window:"undefined"!=typeof self?self:C);var M=setTimeout;function H(e){return Boolean(e&&void 0!==e.length)}function G(){}function J(e){if(!(this instanceof J))throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],Q(e,this)}function V(r,n){for(;3===r._state;)r=r._value;0!==r._state?(r._handled=!0,J._immediateFn(function(){var e=1===r._state?n.onFulfilled:n.onRejected;if(null!==e){var t;try{t=e(r._value)}catch(e){return void $(n.promise,e)}K(n.promise,t)}else(1===r._state?K:$)(n.promise,r._value)})):r._deferreds.push(n)}function K(t,e){try{if(e===t)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var r=e.then;if(e instanceof J)return t._state=3,t._value=e,void X(t);if("function"==typeof r)return void Q((n=r,o=e,function(){n.apply(o,arguments)}),t)}t._state=1,t._value=e,X(t)}catch(e){$(t,e)}var n,o}function $(e,t){e._state=2,e._value=t,X(e)}function X(e){2===e._state&&0===e._deferreds.length&&J._immediateFn(function(){e._handled||J._unhandledRejectionFn(e._value)});for(var t=0,r=e._deferreds.length;t<r;t++)V(e,e._deferreds[t]);e._deferreds=null}function z(e,t,r){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.promise=r}function Q(e,t){var r=!1;try{e(function(e){r||(r=!0,K(t,e))},function(e){r||(r=!0,$(t,e))})}catch(e){if(r)return;r=!0,$(t,e)}}J.prototype.catch=function(e){return this.then(null,e)},J.prototype.then=function(e,t){var r=new this.constructor(G);return V(this,new z(e,t,r)),r},J.prototype.finally=N,J.all=function(t){return new J(function(n,o){if(!H(t))return o(new TypeError("Promise.all accepts an array"));var i=Array.prototype.slice.call(t);if(0===i.length)return n([]);var a=i.length;function s(t,e){try{if(e&&("object"==typeof e||"function"==typeof e)){var r=e.then;if("function"==typeof r)return void r.call(e,function(e){s(t,e)},o)}i[t]=e,0==--a&&n(i)}catch(e){o(e)}}for(var e=0;e<i.length;e++)s(e,i[e])})},J.allSettled=q,J.resolve=function(t){return t&&"object"==typeof t&&t.constructor===J?t:new J(function(e){e(t)})},J.reject=function(r){return new J(function(e,t){t(r)})},J.race=function(o){return new J(function(e,t){if(!H(o))return t(new TypeError("Promise.race accepts an array"));for(var r=0,n=o.length;r<n;r++)J.resolve(o[r]).then(e,t)})},J._immediateFn="function"==typeof setImmediate?function(e){setImmediate(e)}:function(e){M(e,0)},J._unhandledRejectionFn=function(e){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)};var W=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("unable to locate global object")}();"function"!=typeof W.Promise?W.Promise=J:W.Promise.prototype.finally?W.Promise.allSettled||(W.Promise.allSettled=q):W.Promise.prototype.finally=N;var Y=function(){e(i,t(Error));var o=l(i);function i(e,t){var r,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return a(this,i),(r=o.call(this,t)).name="AffiseSDKError",r.code=e,r.details=n,r}return s(i)}(),Z="MISSING_REQUIRED_PARAMS",ee="NETWORK_ERROR",te="SERVER_ERROR",re="INVALID_RESPONSE",ne=function(){function e(){if(a(this,e),this.constructor===e)throw new TypeError("Can not construct abstract class.");if(this._persist===e.prototype._persist)throw new TypeError("Please implement abstract method _persist.");if(this._fetch===e.prototype._fetch)throw new TypeError("Please implement abstract method _fetch.");this._trackingDomain="<<.TrackingDomain>>"}return s(e,[{key:"configure",value:function(e){this._isDefined(e.tracking_domain)&&(this._trackingDomain=e.tracking_domain)}},{key:"click",value:function(v){var b=this;if(this._isDefined(v.affiliate_id)&&this._isDefined(v.offer_id))return new Promise(function(r,n){var e=b._isDefined(v.tracking_domain)?v.tracking_domain:b._trackingDomain,t=new URL("".concat(e,"/click")),o=new URLSearchParams(t.search+"&format=json&websdk=1");o.set("pid",v.affiliate_id),o.set("offer_id",v.offer_id);for(var i={ip:"ip",ua:"user_agent",ref_id:"ref_id",ref_android_id:"ref_android_id",ref_device_id:"ref_device_id",mac_address:"mac_address",os_id:"os_id",user_id:"user_id",ext1:"ext1",ext2:"ext2",ext3:"ext3",imp_id:"imp_id",unid:"unid",fbclid:"fbclid",l:"landing_id"},a=1;a<=30;a++)i["sub".concat(a)]="sub".concat(a);for(var s=0,c=Object.entries(i);s<c.length;s++){var u=g(c[s],2),f=u[0],l=u[1];b._isDefined(v[l])&&o.set(f,v[l])}var h,d=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=_(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw i}}}}(o.entries());try{for(d.s();!(h=d.n()).done;){var p=g(h.value,2),y=p[0],m=p[1];""!==m&&null!=m||o.delete(y)}}catch(e){d.e(e)}finally{d.f()}t.search=o.toString(),fetch(t.toString(),{method:"GET",credentials:"include"}).then(function(e){if(!e.ok)throw new Y(te,"Server responded with status: ".concat(e.status),{status:e.status,url:t.toString()});return e.json()},function(e){var t=new Y(ee,"Network error occurred while tracking click",{originalError:e.message});console.error(t),n(t)}).then(function(e){if(e.clickid&&0<e.clickid.length)b._persist("afclick_".concat(v.offer_id),e.clickid,365),r(e.clickid);else{var t=new Y(re,"Invalid response: missing clickid",{response:e});console.error(t),n(t)}}).catch(n)});var e=new Y(Z,"Missing required parameters: offer_id and/or affiliate_id",{provided:Object.keys(v)});return console.warn(e.message),Promise.reject(e)}},{key:"conversion",value:function(p){var y=this;if(this._isDefined(p.click_id)||this._isDefined(p.promo_code))return new Promise(function(r,n){for(var e=y._isDefined(p.tracking_domain)?p.tracking_domain:y._trackingDomain,o=new URL("".concat(e,"/success.jpg")),t=new URLSearchParams(o.search+"&success=1"),i={afclick:"click_id",afstatus:"status",offer_id:"offer_id",afsecure:"secure",afcomment:"comment",afid:"action_id",afprice:"sum",afgoal:"goal",promo_code:"promo_code",order_sum:"order_sum",order_currency:"order_currency",user_id:"user_id"},a=1;a<=15;a++)i["custom_field".concat(a)]="custom_field".concat(a);for(var s=0,c=Object.entries(i);s<c.length;s++){var u=g(c[s],2),f=u[0],l=u[1];y._isDefined(p[l])&&t.set(f,p[l])}if(y._isDefined(p.items))for(var h=0;h<p.items.length;h++)if(y._isDefined(p.items[h])){var d=p.items[h];y._isDefined(d.order_id)&&t.set("items[".concat(h,"][order_id]"),d.order_id),y._isDefined(d.sku)&&t.set("items[".concat(h,"][sku]"),d.sku),y._isDefined(d.quantity)&&t.set("items[".concat(h,"][quantity]"),d.quantity),y._isDefined(d.price)&&t.set("items[".concat(h,"][price]"),d.price)}o.search=t.toString(),fetch(o.toString(),{method:"GET",headers:{Accept:"application/json"},credentials:"include"}).then(function(e){if(200===e.status)r(!0);else{var t=new Y(te,"Error: Received status code ".concat(e.status),{status:e.status,url:o.toString()});console.error(t),n(t)}}).catch(function(e){var t=new Y(ee,"Network error occurred while tracking conversion",{originalError:e.message});console.error(t),n(t)})});var e=new Y(Z,"Missing required parameter: click_id or promo_code",{provided:Object.keys(p)});return console.warn(e.message),Promise.reject(e)}},{key:"_fetch",value:function(){throw new TypeError("Do not call abstract method _fetch")}},{key:"_persist",value:function(){throw new TypeError("Do not call abstract method _persist")}},{key:"_isDefined",value:function(e){return void 0!==e&&null!=e}},{key:"urlParameter",value:function(e){return new URL(window.location.href).searchParams.get(e)}},{key:"clickId",value:function(e){return this._fetch("afclick_".concat(e))}}]),e}(),oe=function(){function e(){a(this,e),this.storageAvailability={cookie:this._isCookieAvailable(),localStorage:this._isLocalStorageAvailable(),sessionStorage:this._isSessionStorageAvailable()},console.log("AffiseStorage availability:",this.storageAvailability)}return s(e,[{key:"_isCookieAvailable",value:function(){try{document.cookie="testcookie=1; max-age=10";var e=-1!==document.cookie.indexOf("testcookie=");return document.cookie="testcookie=1; max-age=0",e}catch(e){return!1}}},{key:"_isLocalStorageAvailable",value:function(){try{return localStorage.setItem("test","test"),localStorage.removeItem("test"),!0}catch(e){return!1}}},{key:"_isSessionStorageAvailable",value:function(){try{return sessionStorage.setItem("test","test"),sessionStorage.removeItem("test"),!0}catch(e){return!1}}},{key:"store",value:function(e,t,r){var n=24*(2<arguments.length&&void 0!==r?r:30)*60*60*1e3,o={value:t,expires:new Date(Date.now()+n).getTime()},i=[];if(this.storageAvailability.cookie)try{var a=new Date;a.setTime(a.getTime()+n),1650<t.length&&(t=t.substring(0,33)+t.substring(t.length-1616,t.length)),document.cookie="".concat(e,"=").concat(t,";expires=").concat(a.toUTCString(),";path=/"),i.push("cookie")}catch(e){console.warn("Failed to store in cookie:",e)}if(this.storageAvailability.localStorage)try{localStorage.setItem(e,JSON.stringify(o)),i.push("localStorage")}catch(e){console.warn("Failed to store in localStorage:",e)}if(this.storageAvailability.sessionStorage)try{sessionStorage.setItem(e,JSON.stringify(o)),i.push("sessionStorage")}catch(e){console.warn("Failed to store in sessionStorage:",e)}return 0!==i.length||(console.error("All storage methods failed"),!1)}},{key:"retrieve",value:function(e){if(this.storageAvailability.cookie){var t=document.cookie.split(";").map(function(e){return e.split("=")}).reduce(function(e,t){try{e[decodeURIComponent(t[0].trim())]=decodeURIComponent(t[1].trim())}catch(e){}return e},{});if(t[e])return t[e].trim()}if(this.storageAvailability.localStorage)try{var r=JSON.parse(localStorage.getItem(e));if(r&&r.expires>Date.now())return r.value;r&&localStorage.removeItem(e)}catch(e){}if(this.storageAvailability.sessionStorage)try{var n=JSON.parse(sessionStorage.getItem(e));if(n&&n.expires>Date.now())return n.value;n&&sessionStorage.removeItem(e)}catch(e){}return""}},{key:"remove",value:function(e){this.storageAvailability.cookie&&(document.cookie="".concat(e,"=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/")),this.storageAvailability.localStorage&&localStorage.removeItem(e),this.storageAvailability.sessionStorage&&sessionStorage.removeItem(e)}}]),e}(),ie=new(function(){e(r,ne);var t=l(r);function r(){var e;return a(this,r),(e=t.call(this)).storage=new oe,e}return s(r,[{key:"_fetch",value:function(e){return this.storage.retrieve(e)}},{key:"_persist",value:function(e,t,r){var n=2<arguments.length&&void 0!==r?r:30;return this.storage.store(e,t,n)}}]),r}());return"undefined"!=typeof window&&(window.ASDK=ie),ie});
